<!-- <div>
	<div>
		<span>Entity</span>
	</div>
	<button class="uk-button uk-button-default" type="button">{{ this.entitySelection}}</button>
	<div uk-dropdown="pos: bottom-center; mode: click; animation: reveal-left; animate-out: true; duration: 700">
		<ng-container>
			<ul class="uk-nav uk-dropdown-nav" *ngFor="let entity of this.entities">
				<li>
					<button (click)="selectEntity(entity)">
						{{entity}}
					</button>
				</li>
			</ul>
		</ng-container>
	</div>
</div> -->

<div *ngFor="let ctrl of dataseriesForm.controls; let i = index">

    <div class="dataSelectionDiv" >
      <h1>Data Selection</h1>
      <mat-divider></mat-divider>

      <div class="axisDiv">
        <div>
          <h3>Y Axis</h3>
          <mat-form-field>
            <mat-label>Select Entity</mat-label>
            <mat-select [formControl]="entity(i)" (selectionChange)="selectEntity($event)">
              <mat-option>None</mat-option>
              <mat-option [value]="entity" *ngFor="let entity of entities">{{ entity }}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field>
            <mat-label>Select Aggregate</mat-label>
            <mat-select [formControl]="aggregate(i)">
              <mat-option>None</mat-option>
              <mat-option [value]="aggregate.code" *ngFor="let aggregate of aggregates">
                {{ aggregate.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div>
          <h3>X Axis</h3>

          <select-attribute [chosenEntity]="selectedEntity" [formControl]="entity(i)" [attr.name]="selectedEntity"
                            [isDisabled]="false"></select-attribute>

          <mat-form-field class="mat-select-panel">
            <mat-label>Entity Field</mat-label>
            <mat-select [formControl]="entityField(i)">

              <ng-container *ngIf="selectedEntity">
                <!-- <app-entity-selection-component [entityMap]="this.entityMap" [selectedEntity]="this.selectedEntityMap"></app-entity-selection-component> -->


                <!-- Fields -->
                <ng-container *ngFor="let entityField of this.selectedEntityMap[0].fields">
                  <mat-option [value]="entityField.name">
                    {{ entityField.name }}
                  </mat-option>
                </ng-container>

                <!-- Also check mat-tree which might be optimal -->
                <!-- Also check for component in component like a recurring function -->
                <!-- Relations  -->
                <ng-container *ngFor="let entityFieldRelation of selectedEntityMap[0].relations">
                  <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
                    <mat-expansion-panel-header>
                      {{ entityFieldRelation | uppercase }}
                    </mat-expansion-panel-header>
                    <ng-container *ngIf="panelOpenState">
                      <app-entity-selection-component
                        [entityMap]="this.entityMap"
                        [entityFieldRelation]="entityFieldRelation"
                        (outputEvent)="outputResult($event)">
                      </app-entity-selection-component>
                    </ng-container>
                  </mat-expansion-panel>
                </ng-container>


                <!-- <mat-tree [dataSource]="dataSource" [treeControl]="treeControl" class="example-tree">
                <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle>
                  {{node.name}}
                </mat-tree-node>
                <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
                <div class="mat-tree-node">
                  <button mat-icon-button matTreeNodeToggle [attr.aria-label]="'Toggle ' + node.name">
                    <mat-icon class="mat-icon-rtl-mirror">
                      {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
                    </mat-icon>
                  </button>
                  {{node.name}}
                </div>
                <div [class.example-tree-invisible]="!treeControl.isExpanded(node)" role="group">
                  <ng-container matTreeNodeOutlet></ng-container>
                </div>
              </mat-nested-tree-node>
            </mat-tree> -->
              </ng-container>


              <!-- <ng-container *ngFor="let entityField of selectedEntityMap">
            <mat-option [value]="entityField.name">

            </mat-option>
            <mat-optgroup [label]="entityField.name">
              <mat-divider></mat-divider>
              <mat-option [value]="field.name" *ngFor="let field of entityField.fields">
                <mat-expansion-panel>
                  <mat-expansion-panel-header>
                    <mat-panel-title>
                      {{entityField.name}}
                    </mat-panel-title>
                  </mat-expansion-panel-header>
                  {{field.name}}
                </mat-expansion-panel>
              </mat-option>
            </mat-optgroup>
          </ng-container> -->
            </mat-select>
          </mat-form-field>
        </div>
      </div>

      <div class="filtersDiv">
        <!-- TODO check what to do with formArrayName, formGroupName, formControlName -->
        <!-- <div formArrayName="filters"> -->
        <div>
          <h3>Filters</h3>
          <ng-container *ngFor="let filter of filters(i).controls; let j = index">
            <div>
              <button (click)="removeFilter(i, j)">Remove Filter</button>
            </div>
            <!-- <div [formGroupName]="i"> -->
            <div>
              <mat-form-field>
                <mat-label>Field</mat-label>
                <mat-select >
                  <!-- <mat-option *ngFor="let filterField of filterFields" formControlName="field">{{filterField}}</mat-option> -->
                  <mat-option *ngFor="let filterField of filterFields">{{ filterField }}</mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field>
                <mat-label>Operator</mat-label>
                <mat-select>
                  <!-- <mat-option *ngFor="let operator of filterOperators" formControlName="type">{{operator}}</mat-option> -->
                  <mat-option *ngFor="let operator of filterOperators">{{ operator }}</mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field>
                <mat-label>Value</mat-label>
                <!-- <input matInput formControlName="values"> -->
                <input matInput>
              </mat-form-field>
            </div>
          </ng-container>

          <div>
            <button (click)="addFilter(i)">Add Filter</button>
            <br>
            <button (click)="testFilters()">TEST Filters</button>
            <br>
            <button (click)="testLog()">TEST LOG</button>
          </div>
        </div>
      </div>
    </div>

    <div>
      <h1>Options</h1>
      <mat-divider></mat-divider>

      <mat-form-field>
        <mat-label>Stacked Data</mat-label>
        <mat-select [formControl]="stackedData(i)">
          <mat-option disabled="true">Select One</mat-option>
          <mat-option [value]="stackedData.value" *ngFor="let stackedData of stackedDataList">
            {{ stackedData.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <!-- TODO Colorpicker -->
      <!-- <mat-form-field>
        <mat-label>Dataseries Color</mat-label>
      </mat-form-field> -->

    </div>


  <pre>{{ ctrl.value | json }}</pre>
</div>

