<div id="sidebar" class="sidebar_main_swipe uk-flex uk-background-default"
     [class.sidebar_main_active]="open"
     [class.sidebar_mini]="!open">
  <div id="sidebar_main" uk-sticky="end: .sidebar_main_swipe;" offset="80">
    <div sidebar-content="">
      <div id="sidebar_toggle" (click)="toggleSidebar()"></div>
      <div id="sidebar_content">
        <div class="menu_section uk-margin-top" style="min-height: 30vh;">
          <ul id="navTab" uk-nav="duration: 400" class="uk-list uk-nav uk-nav-default" data-uk-switcher="connect: #selection; animation: 'fade'">

            <li class="uk-parent">
              <a class="uk-flex uk-flex-middle" title="Overview" role="button">
                <div class="uk-width-auto">
                  <span class="material-symbols-outlined">group</span>
                </div>
                <div class="uk-width-expand@l uk-margin-small-left hide-on-close">
                  <div class="uk-text-truncate">{{ viewSelectionLabel }}</div>
                  <div class="uk-text-xsmall uk-text-wrap">
                    <ng-container *ngIf="this.view.get('profile')?.value === null || this.view.get('profile')?.value === undefined">
                      Choose what type of data interest you
                    </ng-container>
                    <ng-container *ngIf="this.view.get('profile')?.value !== null && this.view.get('profile')?.value !== undefined">
                      {{ this.view.get('profile')?.value }}
                    </ng-container>
                  </div>
                </div>
              </a>
            </li>

            <li class="uk-parent">
              <a class="uk-flex uk-flex-middle" title="Technologies" role="button">
                <div class="uk-width-auto">
                  <span class="material-symbols-outlined">bar_chart</span>
                </div>
                <div class="uk-width-expand@l uk-margin-small-left hide-on-close">
                  <div class="uk-text-truncate">{{ categorySelectionLabel }}</div>
                  <div class="uk-text-xsmall uk-text-wrap">
                    <ng-container *ngIf="this.category.get('diagram')?.get('type')?.value === null || this.category.get('diagram')?.get('type')?.value === undefined">
                      Choose the type of diagram you want to make
                    </ng-container>
                    <ng-container *ngIf="this.category.get('diagram')?.get('type')?.value !== null && this.category.get('diagram')?.get('type')?.value !== undefined">
                      {{ this.category.get('diagram')?.get('type')?.value }}
                    </ng-container>
                  </div>
                </div>
              </a>
            </li>

            <li class="uk-parent">
              <a [class]="this.hasDataAndDiagramType ? 'uk-flex uk-flex-middle' : 'uk-flex uk-flex-middle uk-disabled uk-text-muted'" title="Organisations" role="button">
                <div class="uk-width-auto">
                  <span class="material-symbols-outlined">database</span>
                </div>
                <div class="uk-width-expand@l uk-margin-small-left hide-on-close">
                  <div class="uk-text-truncate">{{ configureDatasieriesLabel }}</div>
                  <div class="uk-text-xsmall uk-text-wrap">
                    Describe the data you want to see
                  </div>
                </div>
              </a>
            </li>

            <li class="uk-parent">
              <a [class]="this.hasDataAndDiagramType ? 'uk-flex uk-flex-middle' : 'uk-flex uk-flex-middle uk-disabled uk-text-muted'" title="Patents" role="button" aria-controls="uk-nav-60-content-0" aria-expanded="false" aria-disabled="false">
                <div class="uk-width-auto">
                  <span class="material-symbols-outlined">tune</span>
                </div>
                <div class="uk-width-expand@l uk-margin-small-left hide-on-close">
                  <div class="uk-text-truncate">{{ customiseAppearanceLabel }}</div>
                  <div class="uk-text-xsmall uk-text-wrap">
                    Change the way your diagram looks
                  </div>
                </div>
                <!--                      <span class="uk-width-expand@l uk-text-truncate uk-margin-small-left hide-on-close">{{ customiseAppearanceLabel }}</span>-->
              </a>
            </li>

          </ul>

        </div>
      </div>
    </div>
  </div>
  <main class="uk-width-1-1">
    <div id="page_content">
      <div class="uk-grid-divider" uk-grid>
        <div class="uk-width-1-2 column">
          <div class="scrollable">
            <ul id="selection" class="uk-switcher uk-margin">
              <li class="" style="animation-duration: 200ms;">
                <app-view-selector (showViewSelection)="updateStepper($event)" [viewForm]="testingView" [profileControl]="profile"></app-view-selector>
              </li>
              <li class="" style="animation-duration: 200ms;">
                <app-category-selector (showCategorySelection)="updateStepper($event)" [categoryForm]="category"></app-category-selector>
              </li>
              <li class="" style="animation-duration: 200ms;">
                <ng-container *ngIf="hasDataAndDiagramType">
                  <app-dataseries-selector [formGroup]="diagramSettings" [selectedProfile]="profile" [selectedCategory]="categoryName"></app-dataseries-selector>
                </ng-container>
              </li>
              <li class="" style="animation-duration: 200ms;">
                <ng-container *ngIf="this.hasDataAndDiagramType">
                  <app-customise-appearance [appearanceForm]="appearance"></app-customise-appearance>
                </ng-container>
              </li>
            </ul>
            <!-- <div class="actionButtons"> -->
            <div class="uk-width-1-1">
              <div class="uk-flex uk-flex-center actionButtons uk-padding-small">
                <button class="uk-button uk-button-primary" (click)="submitData()"
                        [disabled]="!(view.valid && category.valid && dataseries.valid)">Create Chart
                </button>
                <button class="uk-button uk-button-default uk-margin-small-left" (click)="clearData()">Clear</button>
              </div>
            </div>
          </div>
        </div>
        <div class="uk-width-1-2 column">
          <div class="scrollable">
            <div class="uk-section uk-section-small uk-section-primary uk-preserve-color">
              <div class="uk-container uk-container-expand uk-padding-remove uk-margin-medium-right">

                <pre>{{ diagramSettings.getRawValue() | json }}</pre>

                <div class="iframe-container">

                  <div>
                    <div *ngIf="this.dialogData?.chartObj; else notSubmittedYet">
                      <div *ngIf="hasChanges" class="uk-alert-warning" uk-alert>
                        <!--                      <a href class="uk-alert-close" uk-close></a>-->
                        <p class="uk-text-bold">Your chart is not up to date</p>
                        <p>You updated the values in the control panel, but the chart was not updated automatically. Run the query by clicking on the "Create Chart" button.</p>
                      </div>
                      <div class="container">
                        <chart-frame [chart]="this.dialogData.chartObj"></chart-frame>
                      </div>
                      <div class="actions">
                        <div class="label">
                          <generated-short-url-field [shortUrl]="chartExportingService.chartTinyUrl$"></generated-short-url-field>
                        </div>
                      </div>
                    </div>
                    <ng-template #notSubmittedYet>
                      <div class="uk-text-center uk-flex uk-flex-middle" [style.height.px]="frameHeight">
                        <div>
                          <div><span class="material-symbols-outlined" style="font-size: 80px">bar_chart_4_bars</span></div>
                          <p class="uk-text-bold">Add required control values to preview chart</p>
                          <p class="">Select values in highlighted field(s) in the control panel. Then run the query by clicking on the "Create chart" button.</p>
                        </div>
                      </div>
                    </ng-template>
                  </div>

                  <div class="uk-margin-medium-top">
                    <mat-tab-group mat-stretch-tabs="true" mat-align-tabs="start" animationDuration="250ms">
                      <mat-tab label="Table">
                        <div class="container">
                          <table-frame [table]="this.dialogData.tableObj"></table-frame>
                        </div>
                        <div class="actions">
                          <div class="label">
                            <generated-short-url-field [shortUrl]="chartExportingService.tableTinyUrl$"></generated-short-url-field>
                          </div>
                        </div>
                      </mat-tab>
                      <mat-tab label="Raw Chart Data">
                        <div class="container">
                          <raw-chart-data-frame [rawChartData]="this.dialogData.rawChartDataObj"></raw-chart-data-frame>
                        </div>
                        <div class="actions">
                          <div class="label">
                            <generated-short-url-field [shortUrl]="chartExportingService.rawChartDataTinyUrl$"></generated-short-url-field>
                          </div>
                        </div>
                      </mat-tab>
                      <mat-tab label="Raw Data">
                        <div class="container">
                          <raw-data-frame [rawData]="this.dialogData.rawDataObj"></raw-data-frame>
                        </div>
                        <div class="actions">
                          <div class="label">
                            <generated-short-url-field [shortUrl]="chartExportingService.rawDataTinyUrl$"></generated-short-url-field>
                          </div>
                        </div>
                      </mat-tab>
                    </mat-tab-group>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
